import LightingModel from '../core/LightingModel.js';
import { diffuseColor } from '../core/PropertyNode.js';
import { float } from '../tsl/TSLBase.js';

<<<<<<< HEAD
/**
 * Represents lighting model for a shadow material. Used in {@link ShadowNodeMaterial}.
 *
 * @augments LightingModel
 */
class ShadowMaskModel extends LightingModel {

	/**
	 * Constructs a new shadow mask model.
	 */
=======
class ShadowMaskModel extends LightingModel {

>>>>>>> 1b08ea1de21880f3fba2a757661b8baef5d934b9
	constructor() {

		super();

<<<<<<< HEAD
		/**
		 * The shadow mask node.
		 *
		 * @type {Node}
		 */
=======
>>>>>>> 1b08ea1de21880f3fba2a757661b8baef5d934b9
		this.shadowNode = float( 1 ).toVar( 'shadowMask' );

	}

<<<<<<< HEAD
	/**
	 * Only used to save the shadow mask.
	 *
	 * @param {Object} input - The input data.
	 */
	direct( { lightNode } ) {

		if ( lightNode.shadowNode !== null ) {

			this.shadowNode.mulAssign( lightNode.shadowNode );

		}

	}

	/**
	 * Uses the shadow mask to produce the final color.
	 *
	 * @param {NodeBuilder} builder - The current node builder.
	 */
	finish( { context } ) {
=======
	direct( { shadowMask } ) {

		this.shadowNode.mulAssign( shadowMask );

	}

	finish( context ) {
>>>>>>> 1b08ea1de21880f3fba2a757661b8baef5d934b9

		diffuseColor.a.mulAssign( this.shadowNode.oneMinus() );

		context.outgoingLight.rgb.assign( diffuseColor.rgb ); // TODO: Optimize LightsNode to avoid this assignment

	}

}

export default ShadowMaskModel;
